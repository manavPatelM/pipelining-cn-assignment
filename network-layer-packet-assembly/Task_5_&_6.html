<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Packet Fragmentation & Reassembly Simulator</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f9f9f9;
      color: #222;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #222;
      margin-bottom: 30px;
      font-size: 2.2em;
      font-weight: 500;
      border-bottom: 3px solid #3498db;
      padding-bottom: 10px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .section {
      background: #ffffff;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #ddd;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .section h2 {
      margin-top: 0;
      color: #333;
      font-size: 1.2em;
      font-weight: 600;
      border-bottom: 1px solid #3498db;
      padding-bottom: 5px;
      margin-bottom: 15px;
    }

    .input-group {
      display: flex;
      gap: 15px;
      align-items: center;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    label {
      font-weight: 600;
      min-width: 120px;
    }

    input, select, button {
      padding: 10px 14px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      background: #ffffff;
      color: #222;
    }

    input:focus, select:focus {
      border-color: #3498db;
      outline: none;
    }

    button {
      background: #3498db;
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      padding: 10px 16px;
      border-radius: 6px;
      transition: background 0.3s ease;
    }

    button:hover { background: #2d82c7; }
    .fragment-btn { background: #2980b9; }
    .reassemble-btn { background: #27ae60; }
    .clear-btn { background: #c0392b; }

    .packet, .fragment {
      font-family: 'Courier New', monospace;
      background: #f4f4f4;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      margin: 8px 0;
      color: #222;
    }

    .fragment {
      display: inline-block;
      min-width: 80px;
      text-align: center;
      font-size: 12px;
      margin: 5px;
      background: #fdfdfd;
    }

    .fragment.selected {
      background: #fff6d1;
      border-color: #f1c40f;
    }

    .reassembled {
      background: #e9f8eb;
      border: 1px solid #27ae60;
    }

    .status {
      padding: 8px 12px;
      border-radius: 6px;
      margin: 8px 0;
      font-size: 0.9em;
    }

    .status.success { background: #e8f8ef; color: #27ae60; }
    .status.error { background: #fcebea; color: #e74c3c; }
    .status.info { background: #eaf3fc; color: #3498db; }

    .fragment-pool, .reassembly-area {
      min-height: 150px;
      border: 1px dashed #ccc;
      border-radius: 8px;
      padding: 15px;
      background: #fafafa;
    }

    .stats {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .stat-card {
      flex: 1;
      background: #ffffff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .stat-value {
      font-size: 1.8em;
      font-weight: 500;
      color: #222;
    }

    #finalResult {
      min-height: 120px;
      border: 2px solid #3498db;
      border-radius: 8px;
      padding: 15px;
      background: #fafafa;
      font-size: 0.95em;
      color: #222;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Packet Fragmentation & Reassembly Simulator</h1>

    <!-- Step 1 -->
    <div class="section">
      <h2>Step 1: Input Configuration</h2>
      <div class="input-group">
        <label>Original Data:</label>
        <input type="text" id="originalData" value="Group 1 Presentation: Network Layer Reassembly of Fragmented Packets">
      </div>      
      <div class="input-group">
        <label>MTU Size:</label>
        <input type="number" id="mtuSize" min="8" max="100" value="20">
        <button onclick="fragmentPacket()" class="fragment-btn">Fragment Packet</button>
        <button onclick="clearSimulation()" class="clear-btn">Clear</button>
      </div>
    </div>

    <!-- Step 2 -->
    <div class="section">
      <h2>Step 2: Original Packet</h2>
      <div id="originalPacket"></div>
    </div>

    <!-- Step 3 -->
    <div class="section">
      <h2>Step 3: Fragment Pool</h2>
      <div id="fragmentPool" class="fragment-pool"></div>
    </div>

    <!-- Step 4 -->
    <div class="section">
      <h2>Step 4: Reassembly</h2>
      <div class="input-group">
        <label>Simulation Mode:</label>
        <select id="simulationMode">
          <option value="normal">Normal Order</option>
          <option value="random">Random Order</option>
          <option value="missing">Missing Fragment</option>
          <option value="duplicate">Duplicate Fragment</option>
        </select>
        <button onclick="startReassembly()" id="reassembleBtn" disabled class="reassemble-btn">Start Reassembly</button>
      </div>
      <div id="reassemblyArea" class="reassembly-area"></div>
    </div>

    <!-- Step 5: Final Result -->
    <div class="section">
      <h2>Step 5: Final Result</h2>
      <div id="finalResult"></div>
    </div>

    <!-- Status -->
    <div id="statusArea"></div>

    <!-- Stats -->
    <div class="stats">
      <div class="stat-card">
        <div class="stat-value" id="totalFragments">0</div>
        <div>Total Fragments</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="reassembledFragments">0</div>
        <div>Reassembled</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="efficiency">0%</div>
        <div>Efficiency</div>
      </div>
    </div>
  </div>

  <script>
    /***** Classes *****/
    class PacketFragment {
        constructor(id, offset, length, data, moreFragments = false) {
            this.id = id;
            this.offset = offset;
            this.length = length;
            this.data = data;
            this.moreFragments = moreFragments;
            this.checksum = this.calculateChecksum();
        }

        calculateChecksum() {
            let checksum = 0;
            for (let i = 0; i < this.data.length; i++) {
                checksum += this.data.charCodeAt(i);
            }
            return checksum % 256;
        }

        isValid() {
            return this.calculateChecksum() === this.checksum;
        }
    }

    class PacketReassembler {
        constructor() {
            this.reassemblyBuffer = new Map();
            this.stats = { totalFragments: 0, reassembledFragments: 0, uniqueOffsets: new Set() };
        }

        addFragment(fragment) {
            if (typeof fragment.isValid !== 'function') {
                fragment = new PacketFragment(fragment.id, fragment.offset, fragment.length, fragment.data, fragment.moreFragments);
            }

            if (!fragment.isValid()) {
                throw new Error(`Fragment ${fragment.id} failed checksum validation`);
            }

            const packetId = fragment.id;
            if (!this.reassemblyBuffer.has(packetId)) {
                this.reassemblyBuffer.set(packetId, []);
            }

            const offsetKey = `${packetId}-${fragment.offset}`;
            if (!this.stats.uniqueOffsets.has(offsetKey)) {
                this.stats.uniqueOffsets.add(offsetKey);
                this.stats.reassembledFragments++;
            }

            this.reassemblyBuffer.get(packetId).push(fragment);
            updateStatus(`Fragment ${fragment.id} added (offset: ${fragment.offset}, length: ${fragment.length})`, 'info');

            return this.tryReassemble(packetId);
        }

        tryReassemble(packetId) {
            const fragments = this.reassemblyBuffer.get(packetId);
            if (!fragments) return null;

            fragments.sort((a, b) => a.offset - b.offset);

            let hasLast = false;
            let maxEnd = 0;
            for (let f of fragments) {
                const end = f.offset + f.length;
                if (end > maxEnd) maxEnd = end;
                if (!f.moreFragments) hasLast = true;
            }

            const buf = new Array(maxEnd).fill(null);
            for (let f of fragments) {
                for (let i = 0; i < f.length; i++) {
                    buf[f.offset + i] = f.data.charAt(i);
                }
            }

            const missingIndices = [];
            for (let i = 0; i < buf.length; i++) {
                if (buf[i] === null) missingIndices.push(i);
            }

            if (!hasLast) return null;

            const reassembledData = buf.map(ch =>
                ch === null ? '<span style="color:red;background:#882222;">_</span>' : escapeHtml(ch)
            ).join('');

            if (missingIndices.length === 0) {
                this.reassemblyBuffer.delete(packetId);
                return { id: packetId, data: buf.join(''), fragmentCount: fragments.length, missing: false };
            } else {
                return { id: packetId, data: reassembledData, fragmentCount: fragments.length, missing: true, missingIndices, totalLength: buf.length };
            }
        }

        getStatistics() {
            const efficiency = this.stats.totalFragments > 0 ?
                (this.stats.reassembledFragments / this.stats.totalFragments * 100).toFixed(1) : 0;
            return { totalFragments: this.stats.totalFragments, reassembledFragments: this.stats.reassembledFragments, efficiency };
        }
    }

    /***** UI Helpers *****/
    function updateStatus(message, type='info') {
        const statusArea = document.getElementById('statusArea');
        const statusDiv = document.createElement('div');
        statusDiv.className = `status ${type}`;
        statusDiv.textContent = message;
        statusArea.appendChild(statusDiv);
        setTimeout(() => {
            if (statusDiv.parentNode) statusDiv.remove();
        }, 6000);
    }

    function escapeHtml(str) { return String(str).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;"); }
    function selectFragment(element, index) { element.classList.toggle('selected'); }
    function shuffleArray(array) { const newArray=[...array]; for(let i=newArray.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [newArray[i],newArray[j]]=[newArray[j],newArray[i]];} return newArray;}

    /***** Simulation state *****/
    let fragments = [];
    let reassembler = new PacketReassembler();
    let originalData = '';
    let currentDisplayFragments = [];
    let lastPacketId = null;

    /***** Main Functions *****/
    function fragmentPacket() {
        const data = document.getElementById('originalData').value;
        const mtu = parseInt(document.getElementById('mtuSize').value);
        if (!data || !data.trim()) { updateStatus('Please enter some data to fragment', 'error'); return; }

        originalData = data;
        fragments = [];
        const packetId = Math.floor(Math.random() * 100000);
        lastPacketId = packetId;
        let offset = 0;

        for (let i = 0; i < data.length; i += mtu) {
            const fragmentData = data.slice(i, i + mtu);
            const moreFragments = (i + mtu) < data.length;
            const fragment = new PacketFragment(packetId, offset, fragmentData.length, fragmentData, moreFragments);
            fragments.push(fragment);
            offset += fragmentData.length;
        }

        displayOriginalPacket();
        displayFragments();

        reassembler = new PacketReassembler();
        reassembler.stats.totalFragments = fragments.length;

        document.getElementById('reassembleBtn').disabled = false;
        updateStatus(`Packet fragmented into ${fragments.length} fragments (packetId=${packetId})`, 'success');
        updateStatistics();
    }

    function displayOriginalPacket() {
        const container = document.getElementById('originalPacket');
        container.innerHTML = `<div class="packet">
            <strong>Original Data:</strong> "${originalData}"<br>
            <div class="packet-info">
                Length: ${originalData.length} bytes<br>
                Packet ID: ${lastPacketId}
            </div>
        </div>`;
    }

    function displayFragments() {
        const container = document.getElementById('fragmentPool');
        const mode = document.getElementById('simulationMode').value;
        let display = fragments.slice();

        switch(mode) {
            case 'random': display = shuffleArray(display); break;
            case 'missing': if(display.length>1) display.splice(Math.floor(Math.random()*display.length),1); break;
            case 'duplicate': 
                if(display.length>0) {
                    const randomIndex = Math.floor(Math.random()*display.length);
                    const src = display[randomIndex];
                    const dup = new PacketFragment(src.id, src.offset, src.length, src.data, src.moreFragments);
                    display.push(dup);
                } break;
            default: break;
        }

        container.innerHTML = display.map((fragment, index) => `
            <div class="fragment" onclick="selectFragment(this, ${index})" data-fragment-index="${index}">
                <strong>Fragment ${fragment.id}</strong><br>
                Offset: ${fragment.offset}<br>
                Length: ${fragment.length}<br>
                Data: "${escapeHtml(fragment.data)}"<br>
                More: ${fragment.moreFragments}<br>
                <small>Checksum: ${fragment.checksum}</small>
            </div>`).join('');

        currentDisplayFragments = display;
    }

    async function startReassembly() {
        const reassemblyArea=document.getElementById('reassemblyArea');
        const finalResult=document.getElementById('finalResult');
        reassemblyArea.innerHTML='<div class="status info">Starting reassembly process...</div>';
        finalResult.innerHTML='<em>Group 1 Presentation: Network Layer Reassembly of Fragmented Packets</em>';

        const selectedFragments=document.querySelectorAll('.fragment.selected');
        const fragmentsToProcess=selectedFragments.length>0 ? Array.from(selectedFragments).map(el=>currentDisplayFragments[parseInt(el.dataset.fragmentIndex)]) : currentDisplayFragments || [];

        if(fragmentsToProcess.length===0){ updateStatus('No fragments available to reassemble','error'); return; }

        let finalOutput = null;

        for(let i=0;i<fragmentsToProcess.length;i++){
            const fragment=fragmentsToProcess[i];
            reassemblyArea.innerHTML+=`<div class="fragment" style="margin:5px;">Processing Fragment ${fragment.id} (offset: ${fragment.offset})</div>`;
            await new Promise(resolve=>setTimeout(resolve,300));

            try{
                const result=reassembler.addFragment(fragment);
                if(result) finalOutput = result;
            } catch(error){
                updateStatus(`Error: ${error.message}`,'error');
            }
            updateStatistics();
        }

        if(finalOutput){
            if(finalOutput.missing){
                finalResult.innerHTML=`<div class="packet" style="background:#662222;color:#ffcccc;">
                    <strong>Reassembly Failed - Missing Fragments</strong><br>
                    <div class="packet-info">
                        Data (partial): ${finalOutput.data}<br>
                        Missing byte positions: ${finalOutput.missingIndices.join(', ')}<br>
                        Total Length: ${finalOutput.totalLength} bytes
                    </div>
                </div>`;
                updateStatus('Packet reassembly incomplete due to missing fragments!', 'error');
            } else {
                finalResult.innerHTML=`<div class="packet reassembled">
                    <strong>Successfully Reassembled!</strong><br>
                    <div class="packet-info">
                        Data: ${finalOutput.data}<br>
                        Fragments Used: ${finalOutput.fragmentCount}<br>
                        Length: ${finalOutput.data.length} bytes
                    </div>
                </div>`;
                updateStatus('Packet successfully reassembled!', 'success');
            }
        } else {
            finalResult.innerHTML=`<div class="packet" style="background:#662222;color:#ffcccc;">
                <strong>Reassembly Failed</strong><br>
                <div class="packet-info">No sufficient fragments to reassemble the packet.</div>
            </div>`;
            updateStatus('Could not reassemble packet - missing fragments or invalid data','error');
        }
    }

    function updateStatistics() {
      const stats = reassembler.getStatistics();
      document.getElementById('totalFragments').textContent = reassembler.stats.totalFragments;
      document.getElementById('reassembledFragments').textContent = stats.reassembledFragments;
      document.getElementById('efficiency').textContent = stats.efficiency + '%';
    }

    function clearSimulation() {
        document.getElementById('originalPacket').innerHTML = '';
        document.getElementById('fragmentPool').innerHTML = '';
        document.getElementById('reassemblyArea').innerHTML = '';
        document.getElementById('finalResult').innerHTML = '';
        document.getElementById('statusArea').innerHTML = '';
        document.getElementById('reassembleBtn').disabled = true;

        fragments = [];
        currentDisplayFragments = [];
        reassembler = new PacketReassembler();

        updateStatistics();
    }

    // Initialize statistics on page load
    window.onload = function() {
        updateStatistics();
    };
  </script>
</body>
</html>

  
  
   
